<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"
        integrity="sha512-KZmyTq3PLx9EZl0RHShHQuXtrvdJ+m35tuOiwlcZfs/rE7NZv29ygNA8SFCkMXTnYZQK2OX0Gm2qKGfvWEtRXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.8.3/angular-route.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-cookies/1.8.3/angular-cookies.min.js"
        integrity="sha512-eM4WApD53FS2pv6fIgY4E2utWB82WSp3QPeoemIzA9VeOv9vQ1UzYBKIkXAwS71SCilEFpfkwtCZHj2uSS3keQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body ng-app="app" ng-controller="ctrl">
    <canvas style="width: 80% ;margin:  0 auto;" id="myChart"></canvas>
    <script>
        let app = angular.module("app", ['ngRoute', 'ngCookies'])
        app.controller("ctrl", function ($scope, $rootScope, $http, $location, $routeParams) {
            function getdate() {
                let a = new Date();

                let year = a.getFullYear();
                let month = String(a.getMonth() + 1).padStart(2, '0'); // Thêm số 0 ở đầu nếu cần
                let day = String(a.getDate()).padStart(2, '0'); // Thêm số 0 ở đầu nếu cần

                let formattedDate = year + '-' + month + '-' + day;
                return formattedDate;
            }
            $scope.click = function () {
                $http.get('http://localhost:8080/api/v1/staff/ticketToday?today=' + getdate(), {
                    headers: {
                        'Authorization': 'Bearer ' + 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0cnVvbmdudnBzMjQwODNAZnB0LmVkdS52biIsImlhdCI6MTcwMjE0MDg2MSwiZXhwIjoxNzAyMjI0ODYxfQ.sUqSLz0I6Bgy1-0RG1zso3o75vx8XOO55fQ1m72mWak'
                    }
                }).then(function (response) {
                    console.log(response.data)

                }).catch(function (error) {
                    console.log(error)
                });

            }
            
    $scope.dataTodayAccess = ''
    const ctx = document.getElementById('myChart');
    $scope.lineChartAcess = function (day) {
        $http.get( 'http://localhost:8080/api/v1/staff/access/linchart/' + day, {
            headers: {
                'Authorization': 'Bearer ' + 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0cnVvbmdudnBzMjQwODNAZnB0LmVkdS52biIsImlhdCI6MTcwMjE0MDg2MSwiZXhwIjoxNzAyMjI0ODYxfQ.sUqSLz0I6Bgy1-0RG1zso3o75vx8XOO55fQ1m72mWak'
            }
        }).then(function (response) {
            $scope.dataTodayAccess = response.data
            const data = {
                labels: $scope.dataTodayAccess.map(item => item[0]),
                datasets: [{
                    label: 'Biểu đồ theo dõi truy cập',
                    data: $scope.dataTodayAccess,
                    fill: false,
                    borderColor: 'rgb(190, 182, 092)',
                }]
            };
            const config = {
                type: 'line',
                data: data,
                options: {
                    animations: {
                        tension: {
                            duration: 1000,
                            easing: 'linear',
                            from: 1,
                            to: 0,
                            loop: true
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            };
            const chart = new Chart(ctx, config);
        })
    }

    $scope.lineChartAcess(7)

        })


    </script>
</body>

</html>